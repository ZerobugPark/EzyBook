# ✈️ 간편한 예약으로 액티비티를 더 가까이 EzyBook
![ReadMeTitle](https://github.com/user-attachments/assets/261e3f47-aecf-4b38-ae8b-6837c6277129)
<br><br><br>


## 프로젝트 소개
"EzyBook"은 Easy(쉬운)와 Book(예약)의 합성어로, 누구나 쉽고 간편하게 액티비티를 예약할 수 있는 서비스입니다.  
국내외 다양한 액티비티를 조회하고, PG 결제를 통해 안전하게 예약할 수 있으며,  
커뮤니티와 채팅 기능을 통해 판매자와 실시간으로 소통하거나 예약 후기를 확인할 수 있습니다.  
또한 사용자가 직접 다녀온 액티비티에 대한 리뷰 작성도 가능합니다.


### 주요 기능
#### 1. 회원 및 인증(JWT)
- 소셜/이메일 로그인: 카카오톡, 애플, 이메일 회원 가입/로그인
- 자동 로그인: 앱 재실행 시 자동 로그인 유지

#### 2. 액티비티 탐색 및 예약
- 국내외 액티비티 조회 (카테고리별 / 국가별 필터링 가능)
- 예약 및 결제: PG 연동을 통한 안전한 결제 시스템

#### 3. 소통 및 후기
- 실시간 채팅: Socket 기반의 호스트-유저 간 1:1 채팅
- 리뷰 기능: 이용 후 텍스트 및 이미지 리뷰 작성 가능
- 커뮤니티: 동네 유저들간의 커뮤니티

#### 4. 배너 및 웹뷰 브릿징
- 배너 노출: 검색 화면에서 이벤트/프로모션 배너 노출
- 웹뷰 브릿징: 배너 선택 시 앱 내 웹뷰를 통해 광고 페이지로 이동 / 웹뷰 내 버튼 클릭 시 앱으로 이벤트 전달 



<br><br>

## 프로젝트 정보
기획 및 개발: 2025.05.12 ~ 2025.07.12(약 2달간)  
유지보수 및 기능 업데이트: 2025.07.13 ~  2025.08.17

<br>

### 기술 스택
- **FrameWork** - SwfitUI, Combine, WebKit
- **Library** - KakaoSDK, Realm, iamport_ios, SocketIO, Alamofire, Firebase
- **Architecture** - CleanArchitecture + MVVM + Coordinator(Navigation Stack based)
  
<br>

### 기술 설명
- **최소 지원 iOS 버전**: iOS 16.0
- **Local DB**: Realm
  
<br>

## 아키텍쳐 기준과 핵심 기술

### 아키텍쳐 선정 기준
아키텍처는 개인 개발 상황에서도 복잡성을 줄이고 유지보수를 용이하게 하지만,  
특히 협업 상황에서는 공통된 규칙과 구조를 통해 다른 개발자가 코드를 빠르게 이해하고 기여할 수 있도록 하는 데 큰 의미가 있다고 생각합니다.

이전 프로젝트에서는 ViewModel이 네트워크 호출, 데이터 변환, 화면 흐름까지 모두 책임지면서 비대해졌습니다.  
그 결과 MVC의 Controller처럼 모든 비즈니스 로직이 한 곳에 쏠리는 문제가 발생했고, 테스트가 어렵고 변경에 취약한 구조가 되었습니다.  
이를 개선하기 위해 이번 프로젝트에서는 Clean Architecture를 적용했습니다.  

	•	ViewModel → UI 상태 관리와 사용자 액션 처리에만 집중  
	•	UseCase → 비즈니스 로직과 데이터 변환 분리  
	•	Repository → 데이터 소스 추상화  

SwiftUI의 상태 관리가 강력하기 때문에, 단순한 UI 렌더링 상태라면 ViewModel 없이 MV 구성만으로도 검토해볼 수 있다고 생각합니다.  
다만 ViewModel이 진정으로 의미 있는 순간은, 비즈니스 상태를 UI에서 표현할 수 있는 형태로 가공하는 경우라고 생각합니다.  
이 책임 범위는 앱의 데이터 흐름 구조에 따라 달라질 수 있습니다.

예를 들어 SoT(Source of Truth)가 서버인 경우 ViewModel은 단순히 UI 상태를 표시하는 역할만으로 충분할 수 있으며, 이때는 MV 구조로도 관리가 가능합니다.  
반면 채팅과 같은 실시간 상호작용이나 SoT가 클라이언트인 경우에는 앱이 직접 상태를 저장·동기화해야 하므로 ViewModel의 책임이 커집니다.  
하지만 이때에도 ViewModel이 모든 로직을 떠안으면 다시 비대해질 수 있으므로,  
비즈니스 로직은 UseCase로 분리하고 ViewModel은 UI 상태 관리에만 집중하는 MVVM + Clean Architecture가 더 적합하다고 판단했습니다.

물론 Clean Architecture는 계층 분리가 늘어나는 만큼 관리 복잡도도 커집니다.  
따라서 저는 프로젝트 규모와 팀 상황에 따라 계층을 얼마나 세분화할지를 조절하는 것이 바람직하다고 생각합니다.  
즉, 구조의 선택은 절대적 답이 아니라 맥락에 따라 전략적으로 결정해야 하는 문제라고 보고 있습니다.

<br>

### 이미지 로딩 최적화 (ETag · Memory · Disk Cache)
이미지 로딩 성능과 네트워크 사용량을 최적화하기 위해 ETag 기반 캐싱과 메모리/디스크 캐시를 함께 적용했습니다.  
서버의 ETag가 변경되지 않은 경우에는 불필요한 네트워크 요청을 하지 않고, 캐시된 데이터를 우선적으로 사용하도록 구현했습니다.  
또한 메모리 캐시 → 디스크 캐시 순으로 데이터를 조회하며, 캐시에 데이터가 존재하지 않을 때만 네트워크 요청을 수행해 리소스 사용을 최소화했습니다.  
특히 광고 배너나 정적 리소스뿐만 아니라 프로필 이미지처럼 URL이 변경될 수 있는 동적 리소스에도 ETag 캐싱을 적용했습니다. 이를 통해 같은 URL에서 이미지가 갱신되는 상황에서도 최신 데이터를 안정적으로 불러오면서, 불필요한 네트워크 사용을 최소화할 수 있었습니다.

<br>

### 이미지 리사이징 및 업로드 최적화
아이폰은 기본적으로 **HEIC(고효율 이미지 포맷)**으로 이미지를 저장하며, 일반적인 사진의 용량은 5MB 이하입니다(※ RAW 및 야간 모드 제외).  
그러나 서버는 JPG, JPEG, PNG 확장자만 허용하며 1MB 이하의 이미지만 업로드할 수 있기 때문에, 단순 압축이 아닌 리사이징 후 압축 방식을 채택했습니다.  
먼저 이미지의 가로 또는 세로가 1,200px을 초과하는 경우, 긴 변을 최대 1,200px로 조정하고 짧은 변은 비율에 맞춰 자동 축소합니다.  
이후에도 용량이 1MB를 초과하면, JPEG 손실 압축률을 10% 단위로 점진적으로 낮추는 방식을 반복하여 최종적으로 1MB 이하가 될 때까지 용량을 줄이도록 구현했습니다.

<br>

### Prefetch 최적화가 적용된 Cursor 기반 Pagination
사용자의 스크롤 동작에 맞춰 Prefetch와 Cursor 기반 Pagination을 결합하여 자연스러운 무한 스크롤 경험을 구현했습니다.  
스크롤 이벤트가 발생하면 **다음 데이터(+2 인덱스)**를 미리 로딩해 사용자가 도달하기 전에 데이터를 준비하며, Prefetch는 현재 보유한 데이터 범위 내에서만 동작합니다.  
만약 Prefetch 가능한 데이터가 없을 경우 자동으로 Cursor 기반 Pagination으로 전환되며, 상황에 따라 Prefetch 또는 Pagination 중 하나만 수행됩니다.
또한 Set 컬렉션을 활용해 요청 여부를 관리하여 같은 데이터에 대한 중복 호출을 방지했고, 통신 중인 데이터 상태를 별도로 표시해 불필요한 요청을 차단했습니다.  
새로운 데이터를 가져온 이후에는 **대기 중이던 요청(Pending)**을 한꺼번에 처리하도록 했으며, 이 과정은 TaskGroup을 활용해 비동기로 병렬 실행되어 네트워크 대기 시간을 최소화할 수 있었습니다.





<br><br>

## 페이지별 기능

### [로그인 및 회원가입]

- 앱 실행 시 로그인 화면이 먼저 표시되며, 로그인 후 다음 페이지로 이동합니다.
- 기존에 로그인을 완료한 사용자는 refreshToken을 활용해 자동 로그인할 수 있습니다.
- 회원가입 시 이메일, 비밀번호, 닉네임 입력이 필수이며, 아래 조건을 만족해야 합니
  - **이메일**: 유효한 형식의 이메일
  - **닉네임**: 동일한 닉네임은 사용할 수 없습니다.
  - **비밀번호**: 최소 8자 이상이며 영문자, 숫자, 특수문자((@$!%*#?&))를 각각 1개 이상 포함
- 기존에 로그인을 했다면, refreshToken 여부에 따라 자동로그인을 지원합니다.

| 로그인 및 회원가입 |
|:--------:|
| <img src="https://github.com/user-attachments/assets/b375bd96-a503-4603-ace2-28f0d562a0a8" width="350"/> | 
 

<br><br>

### [메인 화면]

- 신규 액티비티와 전체 액티비티를 확인할 수 있습니다.
- 국가별 또는 카테고리별 필터 기능을 제공합니다.
- 상세화면에서는 리뷰를 확인할 수 있습니다.


| 메인 화면 |
|:--------:|
| <img src="https://github.com/user-attachments/assets/a36811a6-67d0-4db0-be95-bb1772bdc64c" width="350"/> |


<br><br>

### [검색 및 웹뷰 브릿징]

- 국가 또는 카테고리 등으로 액티비티를 검색할 수 있습니다.
- 배너(광고)를 클릭하면 웹뷰 화면으로 이동합니다.
- 웹뷰 내 특정 동작(예: 버튼 클릭)은 네이티브로 이벤트가 전달됩니다.


| 검색 및 웹뷰 브릿징 |
|:--------:|
| <img src="https://github.com/user-attachments/assets/b155efeb-d3d0-4a03-8279-5f161f28746a" width="350"/> |

<br><br>

### [채팅]

- FCM을 통해 백그라운드에서 채팅 알림 수신이 가능합니다.
- 웹소켓 방식을 사용하여 실시간 채팅이 가능합니다.
- 채팅방에서는 사진 또는 파일(PDF)을 확인할 수 있습니다.
- 안 읽은 채팅 개수를 확인할 수 있습니다.


| 채팅 |
|:--------:|
| <img src="https://github.com/user-attachments/assets/1902c42d-9cf4-4eb6-8c93-9d608d51dfba" width="350"/> |

<br><br>

### [커뮤니티]

- 주변 게시글을 조회하거나 검색할 수 있습니다.
- 커뮤니티에의 게시글은 최대 50Km 범위까지 조회가 가능합니다.
- 게시글은 댓글 및 대댓글까지 작성이 가능합니다.

| 커뮤니티 |
|:--------:|
| <img src="https://github.com/user-attachments/assets/0f1c1078-57dc-4bfd-9ef8-d842bf57bdd2" width="350"/> |


<br><br>
  
### [상세화면 및 PG 결제]

- 홍보 영상/이미지, 투어 일정, 예약, 문의하기 기능을 제공합니다.
- 예약 날짜와 인원을 선택한 후 결제하기 버튼을 누르면 결제가 가능합니다.
 
| 상세화면 및 PG 결제 |
|:--------:|
| <img src="https://github.com/user-attachments/assets/63fd42bb-ca5a-407f-9d1a-380e69982eb3" width="350"/> |

<br><br>

### [프로필 설정]

- 프로필 사진 등 사용자 정보를 변경할 수 있습니다.
- 종료된 투어에 대해 리뷰를 작성할 수 있습니다.
- 내가 작성한 게시글 또는 좋아요한 게시글, 액티비티 등을 확인할 수 있습니다.
 
| 프로필 설정 |
|:--------:|
| <img src="https://github.com/user-attachments/assets/f8eba961-e1f3-4895-995e-ac7d714ba5b4" width="350"/> |


<br><br>












